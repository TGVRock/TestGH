import{_ as S}from"./ProcessingComponent.vue_vue_type_script_setup_true_lang-f5a51a45.js";import{_ as N}from"./MosaicInfoComponent.vue_vue_type_script_setup_true_lang-a5ca6096.js";import{_ as R,g as O}from"./DataAreaComponent.vue_vue_type_script_setup_true_lang-e7845056.js";import{d as w,o as l,c as p,a as m,b as $,t as k,_ as G,h as f,k as L,l as A,g as B,e as x,C as b,f as M,p as F,S as H,q as P,w as V,u as D,F as E,r as q}from"./index-f9015245.js";import{a as z}from"./mosaic-2271aab4.js";import{g as U,a as I,b as j}from"./eternalbookprotocol-f50ca92d.js";import"./namespace-f4852e64.js";import"./MosaicInfoRowComponent-754e7cfa.js";const J={class:"row"},K={class:"col-lg-6 align-self-center text-center"},Q={class:"col-lg-6 align-self-center"},W={class:"text-muted"},X={class:"description"},Y=w({__name:"OnChainDataRowComponent",props:{data:null},setup(e){return(r,n)=>(l(),p("div",J,[m("div",K,[$(R,{base64:e.data.base64,mime:e.data.mime},null,8,["base64","mime"])]),m("div",Q,[m("h6",W,k(r.$d(e.data.date,"long")),1),m("h3",null,k(e.data.title),1),m("p",X,k(e.data.description),1)])]))}});const Z=G(Y,[["__scopeId","data-v-76c0e1b6"]]),ee={class:"container"},te=w({__name:"OnChainDataComponent",props:{onChainDataList:null},setup(e){return(r,n)=>(l(),p("article",ee,[(l(),f(Z,{key:`chain-data-${e.onChainDataList.date}`,data:e.onChainDataList},null,8,["data"]))]))}}),ae=L("eternalbook",()=>{const e=A(),r=B(new Map);async function n(c,g){var d;const a="get EternalBookProtocol data:";e.logger.debug(a,"start");const i=await U(g.ownerAddress,[x.TransactionType.AGGREGATE_COMPLETE,x.TransactionType.AGGREGATE_BONDED],g.startHeight);if(i.length===0){e.logger.debug(a,"not exist EternalBookProtocol data");return}for(;i.length>0;){const s=i.pop();if(typeof((d=s==null?void 0:s.transactionInfo)==null?void 0:d.hash)>"u"){e.logger.error(a,"aggregate tx hash undefined."),e.logger.debug(a,"aggregate tx:",s);continue}const t=await I(s,g);if(typeof t>"u"){e.logger.error(a,"fragment undefined."),e.logger.debug(a,"aggregate tx:",s);continue}let o=t,h=t.data,u=t.header.prevTx;for(;u!==null&&u.length>0;){const y=i.findIndex(T=>{var v;return((v=T==null?void 0:T.transactionInfo)==null?void 0:v.hash)===u});if(y<0){u="";break}const C=i[y];if(i.splice(y,1),o=await I(C,g),typeof o>"u"){e.logger.error(a,"fragment undefined."),e.logger.debug(a,"aggregate tx:",C),u="";break}h=o.data+h,u=o.header.prevTx}const _=j(h);typeof o<"u"&&typeof _<"u"&&_===t.header.hash?r.value.set(t.hash,{title:o.header.title||b.STR_NA,description:o.header.description||b.STR_NA,date:t.timestamp,mime:O(h),base64:h}):e.logger.debug(a,"hash incorrect.",_,t.header.hash)}}return{chainData:r,getEBPOnChainData:n}}),de=w({__name:"ResultView",props:{netType:null,mosaicId:null},setup(e){const r=e,n=A(),c=M(),g=ae(),a=B(void 0),i=c.networkType,d="viewer result:";F(()=>{c.networkType!==r.netType&&(n.logger.debug(d,"network change."),c.networkType=r.netType);const t=setInterval(()=>{c.settingState===H.Ready&&(n.logger.debug(d,"chain ready."),clearInterval(t),z(r.mosaicId).then(o=>{n.logger.debug(d,"get mosaic info complete."),a.value=o}).catch(o=>{n.logger.error(d,"get mosaic info failed.",o)}))},b.CHANGE_SETTING_CONFIRM_INTERVAL_MSEC)}),P(()=>{s()});function s(){c.networkType!==i&&(n.logger.debug(d,"network restore."),c.networkType=i)}return V(a,async()=>{const t="viewer result watch:";if(n.logger.debug(t,"start",a.value),typeof a.value>"u"){n.logger.error(t,"not exist mosaic info.");return}g.getEBPOnChainData(c.networkType,a.value).then(()=>{n.logger.debug(t,"get on chain data complete."),s()}).catch(o=>{n.logger.error(t,"get on chain data failed.",o),s()}),n.logger.debug(t,"end")}),(t,o)=>(l(),p(E,null,[D(g).chainData.size===0?(l(),f(S,{key:0,message:t.$t("message.loading")},null,8,["message"])):(l(!0),p(E,{key:1},q(D(g).chainData,([h,u])=>(l(),f(te,{key:h,onChainDataList:u,class:"container animate__animated animate__fadeIn text-break"},null,8,["onChainDataList"]))),128)),typeof a.value>"u"?(l(),f(S,{key:2,message:t.$t("message.loading")},null,8,["message"])):(l(),f(N,{key:3,"mosaic-info":a.value,class:"container animate__animated animate__fadeIn text-break"},null,8,["mosaic-info"]))],64))}});export{de as default};
