import{_ as $}from"./ProcessingComponent.vue_vue_type_script_setup_true_lang-829bdffe.js";import{d as y,g as b,o as i,c as m,a as l,n as L,t as k,b as w,_ as B,h as f,k as R,l as N,e as D,C,f as O,q as U,S as G,s as M,w as F,u as E,F as I,r as P}from"./index-0e0f16ca.js";import{_ as H}from"./MosaicInfoComponent.vue_vue_type_script_setup_true_lang-3264861d.js";import{_ as V,g as z}from"./DataAreaComponent.vue_vue_type_script_setup_true_lang-ab5886e1.js";import{a as q}from"./mosaic-8588ff22.js";import{g as j,a as A,b as J}from"./eternalbookprotocol-cb8d9d85.js";import"./namespace-b982f739.js";import"./MosaicInfoRowComponent-3c1ee04c.js";const K={class:"input-group"},Q=["value"],W=y({__name:"TextCopyComponent",props:{text:null},setup(e){const o=e,t=b(!1);function c(){t.value=!0,navigator.clipboard.writeText(o.text)}return(d,a)=>(i(),m("div",K,[l("input",{value:e.text,type:"text",class:"form-control",readonly:"true"},null,8,Q),l("i",{class:L(["bi input-group-text",{"bi-clipboard":!t.value,"bi-clipboard-check-fill":t.value}]),onClick:c},null,2)]))}}),X={class:"container"},Y={class:"row my-2"},Z={class:"col-3 col-form-label"},ee={class:"col-9"},te=y({__name:"LinkUrlCopyAreaComponent",props:{linkUrl:null},setup(e){return(o,t)=>(i(),m("article",X,[l("div",Y,[l("div",Z,[l("p",null,k(o.$t("viewer.linkUrl")),1)]),l("div",ee,[w(W,{text:e.linkUrl},null,8,["text"])])])]))}});const ae=B(te,[["__scopeId","data-v-4ad80a3e"]]),ne={class:"row"},oe={class:"col-lg-6 align-self-center text-center"},se={class:"col-lg-6 align-self-center"},re={class:"text-muted"},ie={class:"description"},le=y({__name:"OnChainDataRowComponent",props:{data:null},setup(e){return(o,t)=>(i(),m("div",ne,[l("div",oe,[w(V,{base64:e.data.base64,mime:e.data.mime},null,8,["base64","mime"])]),l("div",se,[l("h6",re,k(o.$d(e.data.date,"long")),1),l("h3",null,k(e.data.title),1),l("p",ie,k(e.data.description),1)])]))}});const ce=B(le,[["__scopeId","data-v-76c0e1b6"]]),de={class:"container"},ge=y({__name:"OnChainDataComponent",props:{onChainDataList:null},setup(e){return(o,t)=>(i(),m("article",de,[(i(),f(ce,{key:`chain-data-${e.onChainDataList.date}`,data:e.onChainDataList},null,8,["data"]))]))}}),ue=R("eternalbook",()=>{const e=N(),o=b(new Map);async function t(c,d){var u;const a="get EternalBookProtocol data:";e.logger.debug(a,"start");const g=await j(d.ownerAddress,[D.TransactionType.AGGREGATE_COMPLETE,D.TransactionType.AGGREGATE_BONDED],d.startHeight);if(g.length===0){e.logger.debug(a,"not exist EternalBookProtocol data");return}for(;g.length>0;){const p=g.pop();if(typeof((u=p==null?void 0:p.transactionInfo)==null?void 0:u.hash)>"u"){e.logger.error(a,"aggregate tx hash undefined."),e.logger.debug(a,"aggregate tx:",p);continue}const s=await A(p,d);if(typeof s>"u"){e.logger.error(a,"fragment undefined."),e.logger.debug(a,"aggregate tx:",p);continue}let n=s,r=s.data,_=s.header.prevTx;for(;_!==null&&_.length>0;){const v=g.findIndex(T=>{var S;return((S=T==null?void 0:T.transactionInfo)==null?void 0:S.hash)===_});if(v<0){_="";break}const x=g[v];if(g.splice(v,1),n=await A(x,d),typeof n>"u"){e.logger.error(a,"fragment undefined."),e.logger.debug(a,"aggregate tx:",x),_="";break}r=n.data+r,_=n.header.prevTx}const h=J(r);typeof n<"u"&&typeof h<"u"&&h===s.header.hash?o.value.set(s.hash,{title:n.header.title||C.STR_NA,description:n.header.description||C.STR_NA,date:s.timestamp,mime:z(r),base64:r}):e.logger.debug(a,"hash incorrect.",h,s.header.hash)}}return{chainData:o,getEBPOnChainData:t}}),Te=y({__name:"ResultView",props:{netType:null,mosaicId:null},setup(e){const o=e,t=N(),c=O(),d=ue(),a=b(void 0),g=c.networkType,u="viewer result:",p=t.rootUri+"?netType="+o.netType+"&mosaicId="+o.mosaicId;U(()=>{c.networkType!==o.netType&&(t.logger.debug(u,"network change."),c.networkType=o.netType);const n=setInterval(()=>{c.settingState===G.Ready&&(t.logger.debug(u,"chain ready."),clearInterval(n),q(o.mosaicId).then(r=>{t.logger.debug(u,"get mosaic info complete."),a.value=r}).catch(r=>{t.logger.error(u,"get mosaic info failed.",r)}))},C.CHANGE_SETTING_CONFIRM_INTERVAL_MSEC)}),M(()=>{s()});function s(){c.networkType!==g&&(t.logger.debug(u,"network restore."),c.networkType=g)}return F(a,async()=>{const n="viewer result watch:";if(t.logger.debug(n,"start",a.value),typeof a.value>"u"){t.logger.error(n,"not exist mosaic info.");return}d.getEBPOnChainData(c.networkType,a.value).then(()=>{t.logger.debug(n,"get on chain data complete."),s()}).catch(r=>{t.logger.error(n,"get on chain data failed.",r),s()}),t.logger.debug(n,"end")}),(n,r)=>(i(),m(I,null,[w(ae,{linkUrl:p}),E(d).chainData.size===0?(i(),f($,{key:0,message:n.$t("message.loading")},null,8,["message"])):(i(!0),m(I,{key:1},P(E(d).chainData,([_,h])=>(i(),f(ge,{key:_,onChainDataList:h,class:"container animate__animated animate__fadeIn text-break"},null,8,["onChainDataList"]))),128)),typeof a.value>"u"?(i(),f($,{key:2,message:n.$t("message.loading")},null,8,["message"])):(i(),f(H,{key:3,"mosaic-info":a.value,class:"container animate__animated animate__fadeIn text-break"},null,8,["mosaic-info"]))],64))}});export{Te as default};
